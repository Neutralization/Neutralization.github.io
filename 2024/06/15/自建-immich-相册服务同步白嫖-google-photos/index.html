<!doctype html><html lang=zh-cn dir=ltr><head><meta charset=utf-8><meta name=viewport content='width=device-width,initial-scale=1'><meta name=description content='Google Photos 有着 15GB 的免费空间上限，前几个月自己搞了 NAS 之后，看上了 Immich 相册，算是最贴近 Google Photos 界面的开源自建相册服务了，自己手头也正好还留着当初买的初代 Google P'><title>自建 Immich 相册服务同步白嫖 Google Photos</title>
<link rel=canonical href=https://naizi.ch/2024/06/15/%E8%87%AA%E5%BB%BA-immich-%E7%9B%B8%E5%86%8C%E6%9C%8D%E5%8A%A1%E5%90%8C%E6%AD%A5%E7%99%BD%E5%AB%96-google-photos/><link rel=stylesheet href=/scss/style.min.ac77dcf8b111b51da39a92990f431923f210f3876d85798a2125667f96dc33a4.css><meta property='og:title' content='自建 Immich 相册服务同步白嫖 Google Photos'><meta property='og:description' content='Google Photos 有着 15GB 的免费空间上限，前几个月自己搞了 NAS 之后，看上了 Immich 相册，算是最贴近 Google Photos 界面的开源自建相册服务了，自己手头也正好还留着当初买的初代 Google P'><meta property='og:url' content='https://naizi.ch/2024/06/15/%E8%87%AA%E5%BB%BA-immich-%E7%9B%B8%E5%86%8C%E6%9C%8D%E5%8A%A1%E5%90%8C%E6%AD%A5%E7%99%BD%E5%AB%96-google-photos/'><meta property='og:site_name' content='H⁺ + OH⁻ → H₂O'><meta property='og:type' content='article'><meta property='article:section' content='Post'><meta property='article:tag' content='immich'><meta property='article:tag' content='pixel'><meta property='article:tag' content='syncthing'><meta property='article:tag' content='google photos'><meta property='article:published_time' content='2024-06-15T00:00:00+00:00'><meta property='article:modified_time' content='2024-06-15T15:56:00+08:00'><meta name=twitter:title content="自建 Immich 相册服务同步白嫖 Google Photos"><meta name=twitter:description content="Google Photos 有着 15GB 的免费空间上限，前几个月自己搞了 NAS 之后，看上了 Immich 相册，算是最贴近 Google Photos 界面的开源自建相册服务了，自己手头也正好还留着当初买的初代 Google P"><link rel="shortcut icon" href=favicon.ico></head><body class=article-page><script>(function(){const e="StackColorScheme";localStorage.getItem(e)||localStorage.setItem(e,"auto")})()</script><script>(function(){const t="StackColorScheme",e=localStorage.getItem(t),n=window.matchMedia("(prefers-color-scheme: dark)").matches===!0;e=="dark"||e==="auto"&&n?document.documentElement.dataset.scheme="dark":document.documentElement.dataset.scheme="light"})()</script><div class="container main-container flex on-phone--column extended"><aside class="sidebar left-sidebar sticky"><button class="hamburger hamburger--spin" type=button id=toggle-menu aria-label=切换菜单>
<span class=hamburger-box><span class=hamburger-inner></span></span></button><header><figure class=site-avatar><a href=/><img src=/img/avatar_hu82e0c24ba5ae9ac064fbc1f67d6c68ec_83458_300x0_resize_box_3.png width=300 height=300 class=site-logo loading=lazy alt=Avatar>
</a><span class=emoji>1</span></figure><div class=site-meta><h1 class=site-name><a href=/>H⁺ + OH⁻ → H₂O</a></h1><h2 class=site-description>Neutralized</h2></div></header><ol class=social-menu><li><a href=https://space.bilibili.com/36736561 target=_blank title=bilibili><svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-device-tv" width="44" height="44" viewBox="0 0 24 24" stroke-width="1.5" stroke="#2c3e50" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z" fill="none"/><rect x="3" y="7" width="18" height="13" rx="2"/><polyline points="16 3 12 7 8 3"/></svg></a></li><li><a href=https://github.com/Neutralization target=_blank title=GitHub><svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-brand-github" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentcolor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z" fill="none"/><path d="M9 19c-4.3 1.4-4.3-2.5-6-3m12 5v-3.5c0-1 .1-1.4-.5-2 2.8-.3 5.5-1.4 5.5-6a4.6 4.6.0 00-1.3-3.2 4.2 4.2.0 00-.1-3.2s-1.1-.3-3.5 1.3a12.3 12.3.0 00-6.2.0C6.5 2.8 5.4 3.1 5.4 3.1a4.2 4.2.0 00-.1 3.2A4.6 4.6.0 004 9.5c0 4.6 2.7 5.7 5.5 6-.6.6-.6 1.2-.5 2V21"/></svg></a></li></ol><ol class=menu id=main-menu><li><a href=/archives/><svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-archive" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentcolor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z"/><rect x="3" y="4" width="18" height="4" rx="2"/><path d="M5 8v10a2 2 0 002 2h10a2 2 0 002-2V8"/><line x1="10" y1="12" x2="14" y2="12"/></svg>
<span>Archives</span></a></li><li><a href=/search/><svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-search" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentcolor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z"/><circle cx="10" cy="10" r="7"/><line x1="21" y1="21" x2="15" y2="15"/></svg>
<span>Search</span></a></li><div class=menu-bottom-section><li id=i18n-switch><svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-language" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentcolor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z" fill="none"/><path d="M4 5h7"/><path d="M9 3v2c0 4.418-2.239 8-5 8"/><path d="M5 9c-.003 2.144 2.952 3.908 6.7 4"/><path d="M12 20l4-9 4 9"/><path d="M19.1 18h-6.2"/></svg>
<select name=language onchange="window.location.href=this.selectedOptions[0].value"><option value=https://naizi.ch/ selected></option></select></li><li id=dark-mode-toggle><svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-toggle-left" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentcolor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z"/><circle cx="8" cy="12" r="2"/><rect x="2" y="6" width="20" height="12" rx="6"/></svg>
<svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-toggle-right" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentcolor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z"/><circle cx="16" cy="12" r="2"/><rect x="2" y="6" width="20" height="12" rx="6"/></svg>
<span>暗色模式</span></li></div></ol></aside><main class="main full-width"><article class=main-article><header class=article-header><div class=article-details><header class=article-category><a href=/categories/diy/>DIY</a></header><div class=article-title-wrapper><h2 class=article-title><a href=/2024/06/15/%E8%87%AA%E5%BB%BA-immich-%E7%9B%B8%E5%86%8C%E6%9C%8D%E5%8A%A1%E5%90%8C%E6%AD%A5%E7%99%BD%E5%AB%96-google-photos/>自建 Immich 相册服务同步白嫖 Google Photos</a></h2></div><footer class=article-time><div><svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-calendar-time" width="56" height="56" viewBox="0 0 24 24" stroke-width="2" stroke="currentcolor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z"/><path d="M11.795 21H5a2 2 0 01-2-2V7a2 2 0 012-2h12a2 2 0 012 2v4"/><circle cx="18" cy="18" r="4"/><path d="M15 3v4"/><path d="M7 3v4"/><path d="M3 11h16"/><path d="M18 16.496V18l1 1"/></svg>
<time class=article-time--published>Jun 15, 2024</time></div></footer></div></header><section class=article-content><p>Google Photos 有着 15GB 的免费空间上限，前几个月自己搞了 NAS 之后，看上了 Immich 相册，算是最贴近 Google Photos 界面的开源自建相册服务了，自己手头也正好还留着当初买的初代 Google Pixel，能够以原画质白嫖无限相册空间，相当于能够在本地备份的同时也拥有稳定的云备份。</p><p>考虑到稳定性，NAS 上并没有安装 APP 或者其他容器服务，单纯作为一个存储设备。Docker 服务都放在另一台小主机上运行。</p><p>计划是 TrueNAS 存储只提供 SMB 服务挂载，小主机上通过多个 Docker 分别部署 Immich 相册，以及用来同步照片到 Pixel 的 Syncthing 服务。另外手机肯定是7*24供电的状态，为了不用频繁物理操作，考虑部署 RustDesk 服务远程控制手机，同样采用 Docker 的方式部署在小主机上。</p><h1 id=软硬件配置>软硬件配置</h1><p>TrueNAS 服务器 CPU 是 N100， 16GB 内存， 16TB*2 HDD（Raid 1）</p><p>小主机 CPU 同样是 N100，24GB 内存，256GB SSD，Debian 系统</p><p>初代 Pixel，未 Root</p><h2 id=truenas-配置>TrueNAS 配置</h2><p><img src=/pic/2024-06-15-immich-syncthing-google-photos/TrueNAS_SMB.png loading=lazy alt=TrueNAS_SMB></p><p>非常简单，TrueNAS 上的配置就结束了，继续配置小主机。</p><h2 id=服务器配置>服务器配置</h2><p>首先为了让之后 Immich 从 NAS 上读写，需要把 SMB 开机自动挂载路径。SSH 登陆后执行：</p><blockquote><p>sudo apt install cifs-utils psmisc<br>nano ~/.credentials</p></blockquote><p>对应修改 SMB 共享的用户名和密码</p><pre tabindex=0><code class=language-conf data-lang=conf>username=smbusername
password=smbpassword
</code></pre><blockquote><p>sudo chown username .credentials<br>sudo chmod 600 .credentials</p></blockquote><p>测试挂载</p><blockquote><p>sudo mkdir /mnt/Immich<br>sudo mount -t cifs -o credentials=~/.credentials //truenas.ipaddress/Immich /mnt/Immich</p></blockquote><p>没有问题则暂时卸载</p><blockquote><p>sudo umount -t cifs /mnt/Immich</p></blockquote><p>修改 <code>/etc/fstab</code></p><blockquote><p>sudo nano /etc/fstab</p></blockquote><p>添加如下内容</p><pre tabindex=0><code class=language-conf data-lang=conf># Immich Storage
//truenas.ipaddress/Immich    /mnt/Immich    cifs  credentials=/home/username/.credentials    0    0
</code></pre><p>应用修改完成挂载</p><blockquote><p>sudo systemctl daemon-reload<br>sudo mount -av</p></blockquote><h1 id=docker-配置>Docker 配置</h1><h2 id=安装-dockerhttpsdocsdockercomengineinstalldebian><a class=link href=https://docs.docker.com/engine/install/debian/ target=_blank rel=noopener>安装 Docker</a></h2><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>sudo apt-get update  
</span></span><span style=display:flex><span>sudo apt-get install ca-certificates curl  
</span></span><span style=display:flex><span>sudo install -m <span style=color:#ae81ff>0755</span> -d /etc/apt/keyrings  
</span></span><span style=display:flex><span>sudo curl -fsSL https://download.docker.com/linux/debian/gpg -o /etc/apt/keyrings/docker.asc  
</span></span><span style=display:flex><span>sudo chmod a+r /etc/apt/keyrings/docker.asc  
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>echo <span style=color:#ae81ff>\
</span></span></span><span style=display:flex><span><span style=color:#ae81ff></span>  <span style=color:#e6db74>&#34;deb [arch=</span><span style=color:#66d9ef>$(</span>dpkg --print-architecture<span style=color:#66d9ef>)</span><span style=color:#e6db74> signed-by=/etc/apt/keyrings/docker.asc] https://download.docker.com/linux/debian \
</span></span></span><span style=display:flex><span><span style=color:#e6db74>  </span><span style=color:#66d9ef>$(</span>. /etc/os-release <span style=color:#f92672>&amp;&amp;</span> echo <span style=color:#e6db74>&#34;</span>$VERSION_CODENAME<span style=color:#e6db74>&#34;</span><span style=color:#66d9ef>)</span><span style=color:#e6db74> stable&#34;</span> | <span style=color:#ae81ff>\
</span></span></span><span style=display:flex><span><span style=color:#ae81ff></span>  sudo tee /etc/apt/sources.list.d/docker.list &gt; /dev/null
</span></span><span style=display:flex><span>sudo apt-get update
</span></span><span style=display:flex><span>sudo apt-get install docker-ce docker-ce-cli containerd.io docker-buildx-plugin docker-compose-plugin
</span></span></code></pre></div><h2 id=部署-immich>部署 Immich</h2><p>官方推荐采用 <a class=link href=https://v1.106.4.archive.immich.app/docs/install/docker-compose target=_blank rel=noopener>Docker Compose</a> 的方式安装，跟着教程走并没有什么难度。</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>mkdir ~/immich-app
</span></span><span style=display:flex><span>cd ~/immich-app
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>wget -O docker-compose.yml https://github.com/immich-app/immich/releases/latest/download/docker-compose.yml
</span></span><span style=display:flex><span>wget -O .env https://github.com/immich-app/immich/releases/latest/download/example.env
</span></span><span style=display:flex><span>wget -O hwaccel.transcoding.yml https://github.com/immich-app/immich/releases/latest/download/hwaccel.transcoding.yml
</span></span><span style=display:flex><span>wget -O hwaccel.ml.yml https://github.com/immich-app/immich/releases/latest/download/hwaccel.ml.yml
</span></span></code></pre></div><p>编辑 <code>.env</code> 文件，修改照片的上传路径</p><pre tabindex=0><code class=language-conf data-lang=conf>TZ=Asis/Shanghai
UPLOAD_LOCATION=/mnt/Immich
DB_DATA_LOCATION=./postgres
</code></pre><p>数据库路径不变，之所以这样是因为数据库有频繁的读写，像 16T 容量的机械盘基本都是充气盘，会频繁的发出炒豆子的声音。<br>换言之只要不是充气盘或者距离远听不见声音就无所谓了，可以改成 <code>/mnt/Immich/postgres</code></p><blockquote><p>docker compose up -d</p></blockquote><p>启动容器后，访问 <a class=link href=http://server.ipaddress:2283/ target=_blank rel=noopener>http://server.ipaddress:2283/</a> 登录，在<code>设置</code>/<code>机器学习设置</code>/<code>智能搜索</code>/<code>CLIP模型</code>，修改为支持多语言的<code>XLM-Roberta-Large-Vit-B-16Plus</code>。</p><p>为了便于管理，启用<code>设置</code>/<code>存储模板</code>功能。</p><p>在<code>设置</code>/<code>视频转码设置</code>中，<code>支持的音频编解码器</code>勾选 AAC/MP3/Opus，<code>支持的视频编解码器</code>勾选 H.264/HEVC/VP9/AV1，因为我现在的主力机都支持这些编码，没有必要转码。</p><h2 id=部署-syncthing>部署 Syncthing</h2><p>先建立需要的目录</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>sudo mkdir -p /var/syncthing/Immich
</span></span><span style=display:flex><span>mkdir ~/syncthing
</span></span><span style=display:flex><span>cd ~/syncthing
</span></span><span style=display:flex><span>nano docker-compose.yml
</span></span></code></pre></div><p>按照<a class=link href=https://github.com/syncthing/syncthing/blob/main/README-Docker.md target=_blank rel=noopener>官方指导</a>编写 Dockerfile</p><h2 id=docker-composeyml>docker-compose.yml</h2><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-dockerfile data-lang=dockerfile><span style=display:flex><span>---<span style=color:#960050;background-color:#1e0010>
</span></span></span><span style=display:flex><span><span style=color:#960050;background-color:#1e0010></span>services:<span style=color:#960050;background-color:#1e0010>
</span></span></span><span style=display:flex><span><span style=color:#960050;background-color:#1e0010></span>  syncthing:<span style=color:#960050;background-color:#1e0010>
</span></span></span><span style=display:flex><span><span style=color:#960050;background-color:#1e0010></span>    image: syncthing/syncthing<span style=color:#960050;background-color:#1e0010>
</span></span></span><span style=display:flex><span><span style=color:#960050;background-color:#1e0010></span>    container_name: syncthing<span style=color:#960050;background-color:#1e0010>
</span></span></span><span style=display:flex><span><span style=color:#960050;background-color:#1e0010></span>    hostname: Dorothy<span style=color:#960050;background-color:#1e0010>
</span></span></span><span style=display:flex><span><span style=color:#960050;background-color:#1e0010></span>    environment:<span style=color:#960050;background-color:#1e0010>
</span></span></span><span style=display:flex><span><span style=color:#960050;background-color:#1e0010></span>      - PUID<span style=color:#f92672>=</span><span style=color:#ae81ff>1000</span><span style=color:#960050;background-color:#1e0010>
</span></span></span><span style=display:flex><span><span style=color:#960050;background-color:#1e0010></span>      - PGID<span style=color:#f92672>=</span><span style=color:#ae81ff>1000</span><span style=color:#960050;background-color:#1e0010>
</span></span></span><span style=display:flex><span><span style=color:#960050;background-color:#1e0010></span>    volumes:<span style=color:#960050;background-color:#1e0010>
</span></span></span><span style=display:flex><span><span style=color:#960050;background-color:#1e0010></span>      - /var/syncthing:/var/syncthing<span style=color:#960050;background-color:#1e0010>
</span></span></span><span style=display:flex><span><span style=color:#960050;background-color:#1e0010></span>      - /mnt/Immich/library/admin:/var/syncthing/Immich<span style=color:#960050;background-color:#1e0010>
</span></span></span><span style=display:flex><span><span style=color:#960050;background-color:#1e0010></span>    network_mode: host<span style=color:#960050;background-color:#1e0010>
</span></span></span><span style=display:flex><span><span style=color:#960050;background-color:#1e0010></span>    restart: unless-stopped<span style=color:#960050;background-color:#1e0010>
</span></span></span></code></pre></div><blockquote><p>docker compose up -d</p></blockquote><p>启动容器后，访问 <a class=link href=http://server.ipaddress:8384/ target=_blank rel=noopener>http://server.ipaddress:8384/</a> 登录，添加文件夹</p><p><img src=/pic/2024-06-15-immich-syncthing-google-photos/Syncthing_Immich.png loading=lazy alt=Syncthing_Immich></p><p>在<code>高级</code>书签中选择<code>文件夹类型</code>为<code>仅发送</code></p><p><img src=/pic/2024-06-15-immich-syncthing-google-photos/Syncthing_Immich_extra.png loading=lazy alt=Syncthing_Immich_extra></p><p>这样 Syncthing 的初步配置就结束了</p><h2 id=部署-rustdesk>部署 RustDesk</h2><p>同样按照<a class=link href=https://rustdesk.com/docs/en/self-host/rustdesk-server-oss/docker/ target=_blank rel=noopener>官方指导</a>建立 Dockerfile</p><h2 id=docker-composeyml-1>docker-compose.yml</h2><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-dockerfile data-lang=dockerfile><span style=display:flex><span>---<span style=color:#960050;background-color:#1e0010>
</span></span></span><span style=display:flex><span><span style=color:#960050;background-color:#1e0010></span>services:<span style=color:#960050;background-color:#1e0010>
</span></span></span><span style=display:flex><span><span style=color:#960050;background-color:#1e0010></span>  hbbs:<span style=color:#960050;background-color:#1e0010>
</span></span></span><span style=display:flex><span><span style=color:#960050;background-color:#1e0010></span>    container_name: hbbs<span style=color:#960050;background-color:#1e0010>
</span></span></span><span style=display:flex><span><span style=color:#960050;background-color:#1e0010></span>    image: rustdesk/rustdesk-server:latest<span style=color:#960050;background-color:#1e0010>
</span></span></span><span style=display:flex><span><span style=color:#960050;background-color:#1e0010></span>    command: hbbs<span style=color:#960050;background-color:#1e0010>
</span></span></span><span style=display:flex><span><span style=color:#960050;background-color:#1e0010></span>    volumes:<span style=color:#960050;background-color:#1e0010>
</span></span></span><span style=display:flex><span><span style=color:#960050;background-color:#1e0010></span>      - ./data:/root<span style=color:#960050;background-color:#1e0010>
</span></span></span><span style=display:flex><span><span style=color:#960050;background-color:#1e0010></span>    network_mode: <span style=color:#e6db74>&#34;host&#34;</span><span style=color:#960050;background-color:#1e0010>
</span></span></span><span style=display:flex><span><span style=color:#960050;background-color:#1e0010>
</span></span></span><span style=display:flex><span><span style=color:#960050;background-color:#1e0010></span>    depends_on:<span style=color:#960050;background-color:#1e0010>
</span></span></span><span style=display:flex><span><span style=color:#960050;background-color:#1e0010></span>      - hbbr<span style=color:#960050;background-color:#1e0010>
</span></span></span><span style=display:flex><span><span style=color:#960050;background-color:#1e0010></span>    restart: always<span style=color:#960050;background-color:#1e0010>
</span></span></span><span style=display:flex><span><span style=color:#960050;background-color:#1e0010>
</span></span></span><span style=display:flex><span><span style=color:#960050;background-color:#1e0010></span>  hbbr:<span style=color:#960050;background-color:#1e0010>
</span></span></span><span style=display:flex><span><span style=color:#960050;background-color:#1e0010></span>    container_name: hbbr<span style=color:#960050;background-color:#1e0010>
</span></span></span><span style=display:flex><span><span style=color:#960050;background-color:#1e0010></span>    image: rustdesk/rustdesk-server:latest<span style=color:#960050;background-color:#1e0010>
</span></span></span><span style=display:flex><span><span style=color:#960050;background-color:#1e0010></span>    command: hbbr<span style=color:#960050;background-color:#1e0010>
</span></span></span><span style=display:flex><span><span style=color:#960050;background-color:#1e0010></span>    volumes:<span style=color:#960050;background-color:#1e0010>
</span></span></span><span style=display:flex><span><span style=color:#960050;background-color:#1e0010></span>      - ./data:/root<span style=color:#960050;background-color:#1e0010>
</span></span></span><span style=display:flex><span><span style=color:#960050;background-color:#1e0010></span>    network_mode: <span style=color:#e6db74>&#34;host&#34;</span><span style=color:#960050;background-color:#1e0010>
</span></span></span><span style=display:flex><span><span style=color:#960050;background-color:#1e0010></span>    restart: always<span style=color:#960050;background-color:#1e0010>
</span></span></span></code></pre></div><p>启动服务</p><blockquote><p>docker compose up -d</p></blockquote><p>获取服务端 API KEY</p><blockquote><p>docker container logs hbbs | grep Key</p></blockquote><h1 id=配置-pixel-自动任务>配置 Pixel 自动任务</h1><p>首先安装 <a class=link href=https://f-droid.org/packages/com.nutomic.syncthingandroid/ target=_blank rel=noopener>Syncthing</a> 和 <a class=link href=https://f-droid.org/packages/com.carriez.flutter_hbb/ target=_blank rel=noopener>RustDesk</a> 的客户端</p><p>然后是用来实现自动任务的 <a class=link href="https://play.google.com/store/apps/details?id=net.dinglisch.android.taskerm" target=_blank rel=noopener>Tasker</a> 和 <a class=link href="https://play.google.com/store/apps/details?id=com.balda.touchtask" target=_blank rel=noopener>TouchTask</a></p><h2 id=连接-rustdesk>连接 RustDesk</h2><p>修改对应的服务器 IP 地址和 KEY</p><p><img src=/pic/2024-06-15-immich-syncthing-google-photos/RustDesk.png loading=lazy alt=RustDesk></p><p>允许 IP 地址访问，保持后台服务，允许自启动</p><p><img src=/pic/2024-06-15-immich-syncthing-google-photos/RustDesk_Setting.png loading=lazy alt=RustDesk_Setting></p><p>设置固定密码，使用固定密码</p><p><img src=/pic/2024-06-15-immich-syncthing-google-photos/RustDesk_passwd.png loading=lazy alt=RustDesk_passwd></p><p>勾选全部权限后启动服务</p><p><img src=/pic/2024-06-15-immich-syncthing-google-photos/RustDesk_Service.png loading=lazy alt=RustDesk_Service></p><p>在自己的主机上也装好 Rustdesk，修改对应的服务器 IP 地址和 KEY 信息后，现在就可以接上充电线放在一边，通过电脑远程操作 Pixel 了。</p><h2 id=连接-syncthing>连接 Syncthing</h2><p>选择 Syncthing 的<code>设备</code>然后点击右上角<code>+</code>，添加设备</p><p><img src=/pic/2024-06-15-immich-syncthing-google-photos/Synthing_device.png loading=lazy alt=Synthing_device></p><p>回到 <a class=link href=http://server.ipaddress:8384/ target=_blank rel=noopener>http://server.ipaddress:8384/</a> 登录，点击识别的设备标识，通过手机扫码或者直接输入完整设备标识字符串进行配对</p><p><img src=/pic/2024-06-15-immich-syncthing-google-photos/Synthing_id.png loading=lazy alt=Synthing_id></p><p>然后网页端会出现配对许可的提示，同意即可。</p><p>接着编辑之前共享的目录，共享给配对的设备。</p><p><img src=/pic/2024-06-15-immich-syncthing-google-photos/Synthing_share.png loading=lazy alt=Synthing_share></p><p>回到手机，同意接收共享，将目录选为照相机的默认目录 <code>/storage/emulated/0/DCIM/Camera</code>，目录种类更改为仅接收。</p><p>这样就实现了 Immich 从 NAS 往 Pixel 的单向同步，之后在 Pixel 上清除本地缓存时也不会导致 NAS 上的文件被同步删除，Pixel 也会自动将同步收到的照片上传至 Google Photos。</p><h2 id=配置-tasker>配置 Tasker</h2><p>为了避免手机存储满了之后无法继续同步文件，需要定期运行相册 APP 释放空间，这里就可以使用 Tasker 来完成。</p><p>主要的操作一共三种：</p><ol><li><code>+</code>/<code>任务</code>/<code>等待</code></li><li><code>+</code>/<code>程序</code>/<code>启动应用/结束应用</code></li><li><code>+</code>/<code>插件</code>/<code>TouchTask</code>/<code>Actions</code></li></ol><p><img src=/pic/2024-06-15-immich-syncthing-google-photos/Tasker_add_1.png loading=lazy alt=Tasker_add_1><img src=/pic/2024-06-15-immich-syncthing-google-photos/Tasker_add_2.png loading=lazy alt=Tasker_add_2></p><p><img src=/pic/2024-06-15-immich-syncthing-google-photos/Tasker_add_3.png loading=lazy alt=Tasker_add_3><img src=/pic/2024-06-15-immich-syncthing-google-photos/Tasker_add_4.png loading=lazy alt=Tasker_add_4></p><p>屏幕点击操作需要的坐标数据可以通过打开<code>开发者选项</code>/<code>输入</code>/<code>指针位置</code>来获取</p><p>然后按照</p><p>等待/结束相册/启动相册/等待/点击头像/释放空间/确定释放/等待/启动Tasker（回前台）</p><p>的逻辑添加操作步骤即可</p><p><img src=/pic/2024-06-15-immich-syncthing-google-photos/Tasker.png loading=lazy alt=Tasker></p><p>之后添加配置文件，让任务定时执行</p><p><img src=/pic/2024-06-15-immich-syncthing-google-photos/Tasker_config.png loading=lazy alt=Tasker_config><img src=/pic/2024-06-15-immich-syncthing-google-photos/Tasker_timer.png loading=lazy alt=Tasker_timer></p><h2 id=fakestandby>FakeStandby</h2><p>为了不需要 Root 权限，Pixel 设置了不锁屏，但保持亮屏一是容易造成烧屏，二十造成无意义的耗电，为此可以安装 <a class=link href=https://f-droid.org/packages/android.jonas.fakestandby/ target=_blank rel=noopener>FakeStandby</a> 这款应用，通过显示黑屏实现伪锁屏待机。</p><p>FakeStandby
<img src=/pic/2024-06-15-immich-syncthing-google-photos/FakeStandby.png loading=lazy alt=FakeStandby></p><h1 id=导入-google-photos>导入 Google Photos</h1><p>最后，对于已经在 Google 相册中的照片，可以通过 Google 导出服务和 immich-go 工具便捷的导入 Immich。</p><p>访问 <a class=link href=https://takeout.google.com/settings/takeout/custom/photos target=_blank rel=noopener>https://takeout.google.com/settings/takeout/custom/photos</a> 在要包含的数据中选择 <code>Google 相册</code>，继续，然后再目标位置选择<code>添加到 OneDrive</code>，文件类型选择<code>.zip</code>，大小选择<code>50GB</code>。</p><p>视具体网络情况，选择通过 OneDrive 可以直连下载，节约大量的代理流量。</p><p>网页端登录 Immich，点击头像/<code>账号设定</code>/<code>API Keys</code>/<code>新API Key</code>，复制下 Key 字符串。</p><p>Google 导出结束后，下载<a class=link href=https://github.com/simulot/immich-go target=_blank rel=noopener>immich-go</a>，将解压的 exe 文件和 Google 导出的 zip 放在同一目录中，打开命令行 cd 到此目录并执行</p><blockquote><p>.\immich-go.exe -server=http://immich.ipaddress:2283 -key=API_KEY_STRING upload -google-photos takeout-*.zip</p></blockquote><p>即可将过去的相册内容导入至 Immich。</p><h2 id=eof>EOF</h2><p>Google 目前的政策只有初代 Pixel 能够上传原始画质享有无限空间，后代的 Pixel 也只有最早的几代能够上传省空间画质且享有无限空间。</p><p>目前闲鱼 2~300 收一个初代 Pixel 还是合算的，不过哪天 Pixel 电池顶不住了，是换电池还是换机，亦或者直接抛弃 Google 相册，就见仁见智了。</p></section><footer class=article-footer><section class=article-tags><a href=/tags/immich/>Immich</a>
<a href=/tags/pixel/>Pixel</a>
<a href=/tags/syncthing/>Syncthing</a>
<a href=/tags/google-photos/>Google Photos</a></section><section class=article-lastmod><svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-clock" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentcolor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z"/><circle cx="12" cy="12" r="9"/><polyline points="12 7 12 12 15 15"/></svg>
<span>最后更新于 Jun 15, 2024 15:56 +0800</span></section></footer></article><footer class=site-footer><section class=copyright>&copy;
2018 -
2024 H⁺ + OH⁻ → H₂O</section><section class=powerby>Built with <a href=https://gohugo.io/ target=_blank rel=noopener>Hugo</a><br>主题 <b><a href=https://github.com/CaiJimmy/hugo-theme-stack target=_blank rel=noopener data-version=3.12.0>Stack</a></b> 由 <a href=https://jimmycai.com target=_blank rel=noopener>Jimmy</a> 设计</section></footer><div class=pswp tabindex=-1 role=dialog aria-hidden=true><div class=pswp__bg></div><div class=pswp__scroll-wrap><div class=pswp__container><div class=pswp__item></div><div class=pswp__item></div><div class=pswp__item></div></div><div class="pswp__ui pswp__ui--hidden"><div class=pswp__top-bar><div class=pswp__counter></div><button class="pswp__button pswp__button--close" title="Close (Esc)"></button>
<button class="pswp__button pswp__button--share" title=Share></button>
<button class="pswp__button pswp__button--fs" title="Toggle fullscreen"></button>
<button class="pswp__button pswp__button--zoom" title="Zoom in/out"></button><div class=pswp__preloader><div class=pswp__preloader__icn><div class=pswp__preloader__cut><div class=pswp__preloader__donut></div></div></div></div></div><div class="pswp__share-modal pswp__share-modal--hidden pswp__single-tap"><div class=pswp__share-tooltip></div></div><button class="pswp__button pswp__button--arrow--left" title="Previous (arrow left)">
</button>
<button class="pswp__button pswp__button--arrow--right" title="Next (arrow right)"></button><div class=pswp__caption><div class=pswp__caption__center></div></div></div></div></div><script src=https://cdn.jsdelivr.net/npm/photoswipe@4.1.3/dist/photoswipe.min.js integrity="sha256-ePwmChbbvXbsO02lbM3HoHbSHTHFAeChekF1xKJdleo=" crossorigin=anonymous defer></script><script src=https://cdn.jsdelivr.net/npm/photoswipe@4.1.3/dist/photoswipe-ui-default.min.js integrity="sha256-UKkzOn/w1mBxRmLLGrSeyB4e1xbrp4xylgAWb3M42pU=" crossorigin=anonymous defer></script><link rel=stylesheet href=https://cdn.jsdelivr.net/npm/photoswipe@4.1.3/dist/default-skin/default-skin.min.css crossorigin=anonymous><link rel=stylesheet href=https://cdn.jsdelivr.net/npm/photoswipe@4.1.3/dist/photoswipe.min.css crossorigin=anonymous></main><aside class="sidebar right-sidebar sticky"><section class="widget archives"><div class=widget-icon><svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-hash" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentcolor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z"/><line x1="5" y1="9" x2="19" y2="9"/><line x1="5" y1="15" x2="19" y2="15"/><line x1="11" y1="4" x2="7" y2="20"/><line x1="17" y1="4" x2="13" y2="20"/></svg></div><h2 class="widget-title section-title">目录</h2><div class=widget--toc><nav id=TableOfContents><ul><li><a href=#truenas-配置>TrueNAS 配置</a></li><li><a href=#服务器配置>服务器配置</a></li></ul><ul><li><a href=#安装-dockerhttpsdocsdockercomengineinstalldebian><a href=https://docs.docker.com/engine/install/debian/>安装 Docker</a></a></li><li><a href=#部署-immich>部署 Immich</a></li><li><a href=#部署-syncthing>部署 Syncthing</a></li><li><a href=#docker-composeyml>docker-compose.yml</a></li><li><a href=#部署-rustdesk>部署 RustDesk</a></li><li><a href=#docker-composeyml-1>docker-compose.yml</a></li></ul><ul><li><a href=#连接-rustdesk>连接 RustDesk</a></li><li><a href=#连接-syncthing>连接 Syncthing</a></li><li><a href=#配置-tasker>配置 Tasker</a></li><li><a href=#fakestandby>FakeStandby</a></li></ul><ul><li><a href=#eof>EOF</a></li></ul></nav></div></section></aside></div><script src=https://cdn.jsdelivr.net/npm/node-vibrant@3.1.6/dist/vibrant.min.js integrity="sha256-awcR2jno4kI5X0zL8ex0vi2z+KMkF24hUW8WePSA9HM=" crossorigin=anonymous></script><script type=text/javascript src=/ts/main.js defer></script><script>(function(){const e=document.createElement("link");e.href="https://fonts.googleapis.com/css2?family=Lato:wght@300;400;700&display=swap",e.type="text/css",e.rel="stylesheet",document.head.appendChild(e)})()</script></body></html>